<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON 转 YAML 转换器</title>
    <!-- 使用 Tailwind CSS 构建 UI -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 集成 js-yaml 库进行核心转换逻辑 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background-color: #f8fafc;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(226, 232, 240, 0.8);
        }

        .editor-container {
            min-height: 400px;
        }

        textarea {
            font-family: 'Fira Code', 'Cascadia Code', monospace;
            resize: none;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-6xl mx-auto">
        <!-- 头部 -->
        <header class="mb-8 text-center">
            <h1 class="text-3xl font-bold text-slate-800 mb-2">JSON <span class="text-blue-600">to</span> YAML</h1>
            <p class="text-slate-500">一个简单、快速且安全的本地格式转换工具</p>
        </header>

        <!-- 主界面 -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            
            <!-- 输入区域 -->
            <div class="flex flex-col gap-3">
                <div class="flex items-center justify-between">
                    <label class="text-sm font-semibold text-slate-700 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-500"><path d="M4 17l6-6-6-6M12 19h8"/></svg>
                        JSON 输入
                    </label>
                    <div class="flex gap-2">
                        <button onclick="loadSample()" class="text-xs px-3 py-1 bg-white border border-slate-200 rounded-full hover:bg-slate-50 text-slate-600 transition-all shadow-sm">加载示例</button>
                        <button onclick="clearAll()" class="text-xs px-3 py-1 bg-white border border-slate-200 rounded-full hover:bg-red-50 hover:text-red-600 text-slate-600 transition-all shadow-sm">清空</button>
                    </div>
                </div>
                <div class="glass-panel rounded-2xl overflow-hidden shadow-sm flex-1 relative">
                    <textarea 
                        id="jsonInput" 
                        class="w-full h-full min-h-[400px] p-4 text-sm focus:outline-none custom-scrollbar text-slate-700 placeholder:text-slate-300"
                        placeholder='在此粘贴您的 JSON 代码...'
                        spellcheck="false"
                    ></textarea>
                </div>
            </div>

            <!-- 输出区域 -->
            <div class="flex flex-col gap-3">
                <div class="flex items-center justify-between">
                    <label class="text-sm font-semibold text-slate-700 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-green-500"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
                        YAML 输出
                    </label>
                    <button id="copyBtn" onclick="copyResult()" class="text-xs px-3 py-1 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-all shadow-md flex items-center gap-1">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                        复制结果
                    </button>
                </div>
                <div class="glass-panel rounded-2xl overflow-hidden shadow-sm flex-1 relative bg-slate-900 border-none">
                    <textarea 
                        id="yamlOutput" 
                        class="w-full h-full min-h-[400px] p-4 text-sm focus:outline-none custom-scrollbar text-blue-100 bg-transparent placeholder:text-slate-600"
                        placeholder="等待转换结果..."
                        readonly
                        spellcheck="false"
                    ></textarea>
                    
                    <!-- 错误提示框 -->
                    <div id="errorBox" class="absolute bottom-4 left-4 right-4 bg-red-500/90 text-white text-xs p-3 rounded-lg hidden animate-in fade-in slide-in-from-bottom-2 duration-300">
                        <div class="font-bold mb-1 flex items-center gap-1">
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
                            JSON 格式错误:
                        </div>
                        <span id="errorMessage" class="opacity-90"></span>
                    </div>
                </div>
            </div>

        </div>

        <!-- 转换设置 (可选) -->
        <div class="glass-panel p-4 rounded-2xl shadow-sm flex flex-wrap items-center gap-6">
            <div class="flex items-center gap-2">
                <span class="text-sm text-slate-600">缩进空格:</span>
                <select id="indentation" class="bg-slate-100 border-none rounded-md text-sm p-1 px-2 focus:ring-2 focus:ring-blue-500 outline-none">
                    <option value="2">2 个空格</option>
                    <option value="4">4 个空格</option>
                </select>
            </div>
            <div class="flex items-center gap-2">
                <input type="checkbox" id="sortKeys" class="w-4 h-4 rounded text-blue-600 focus:ring-blue-500 border-slate-300">
                <label for="sortKeys" class="text-sm text-slate-600 cursor-pointer">按键名排序</label>
            </div>
            <div class="ml-auto flex items-center gap-2 text-xs text-slate-400">
                <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                本地安全转换 (无数据上传)
            </div>
        </div>
        
        <!-- 提示信息 -->
        <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 px-6 py-3 bg-slate-800 text-white rounded-full shadow-2xl text-sm transition-all opacity-0 pointer-events-none translate-y-4">
            已成功复制到剪贴板！
        </div>
    </div>

    <script>
        const jsonInput = document.getElementById('jsonInput');
        const yamlOutput = document.getElementById('yamlOutput');
        const errorBox = document.getElementById('errorBox');
        const errorMessage = document.getElementById('errorMessage');
        const indentSelect = document.getElementById('indentation');
        const sortKeysCheckbox = document.getElementById('sortKeys');

        // 核心转换函数
        function convert() {
            const rawValue = jsonInput.value.trim();
            
            if (!rawValue) {
                yamlOutput.value = '';
                hideError();
                return;
            }

            try {
                // 1. 解析 JSON
                const parsed = JSON.parse(rawValue);
                
                // 2. 配置转换选项
                const options = {
                    indent: parseInt(indentSelect.value),
                    sortKeys: sortKeysCheckbox.checked,
                    noRefs: true,
                    lineWidth: -1 // 避免自动折行
                };

                // 3. 转换为 YAML
                const yaml = jsyaml.dump(parsed, options);
                
                // 4. 更新 UI
                yamlOutput.value = yaml;
                hideError();
            } catch (err) {
                showError(err.message);
            }
        }

        // 错误处理
        function showError(msg) {
            errorMessage.textContent = msg;
            errorBox.classList.remove('hidden');
            yamlOutput.classList.add('opacity-50');
        }

        function hideError() {
            errorBox.classList.add('hidden');
            yamlOutput.classList.remove('opacity-50');
        }

        // 复制功能
        function copyResult() {
            if (!yamlOutput.value) return;
            
            yamlOutput.select();
            document.execCommand('copy');
            
            showToast('已成功复制到剪贴板！');
            
            // 按钮视觉反馈
            const btn = document.getElementById('copyBtn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '已复制！';
            setTimeout(() => {
                btn.innerHTML = originalText;
            }, 2000);
        }

        // 加载示例
        function loadSample() {
            const sample = {
                "project": "JSON to YAML Converter",
                "version": "1.0.0",
                "author": {
                    "name": "Gemini",
                    "role": "Assistant"
                },
                "features": [
                    "Real-time processing",
                    "Local security",
                    "Modern UI",
                    "No React dependency"
                ],
                "active": true
            };
            jsonInput.value = JSON.stringify(sample, null, 2);
            convert();
        }

        // 清空
        function clearAll() {
            jsonInput.value = '';
            yamlOutput.value = '';
            hideError();
        }

        // 吐司提示
        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.classList.remove('opacity-0', 'translate-y-4', 'pointer-events-none');
            
            setTimeout(() => {
                toast.classList.add('opacity-0', 'translate-y-4', 'pointer-events-none');
            }, 3000);
        }

        // 事件监听
        jsonInput.addEventListener('input', convert);
        indentSelect.addEventListener('change', convert);
        sortKeysCheckbox.addEventListener('change', convert);

        // 初始化
        window.onload = () => {
            // 自动对焦
            jsonInput.focus();
        };
    </script>
</body>
</html>
